<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Developer Path ‚Äî De Backend a AI</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;700;800&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #030712;
  --surface: #0d1117;
  --surface2: #161b22;
  --border: #21262d;
  --accent: #00ff88;
  --accent2: #00b4ff;
  --accent3: #ff6b35;
  --gold: #ffd700;
  --text: #e6edf3;
  --muted: #7d8590;
  --danger: #ff4757;
  --font-display: 'Syne', sans-serif;
  --font-mono: 'Space Mono', monospace;
  --font-body: 'IBM Plex Sans', sans-serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ CANVAS ‚îÄ‚îÄ */
#bg-canvas {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 0;
  pointer-events: none;
}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 2rem;
  background: rgba(3,7,18,0.85);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
}

.nav-logo {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  color: var(--accent);
  letter-spacing: 0.1em;
}

.nav-links {
  display: flex;
  gap: 1.5rem;
  list-style: none;
}

.nav-links a {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--muted);
  text-decoration: none;
  letter-spacing: 0.05em;
  transition: color 0.2s;
}

.nav-links a:hover { color: var(--accent); }

.nav-xp {
  font-family: var(--font-mono);
  font-size: 0.75rem;
  color: var(--gold);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.xp-bar-wrap {
  width: 80px;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
}

.xp-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold), var(--accent3));
  border-radius: 2px;
  transition: width 0.5s ease;
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
#hero {
  position: relative;
  z-index: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 6rem 2rem 4rem;
}

.hero-label {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--accent);
  letter-spacing: 0.3em;
  text-transform: uppercase;
  margin-bottom: 1.5rem;
  opacity: 0;
  animation: fadeUp 0.8s 0.3s forwards;
}

.hero-title {
  font-family: var(--font-display);
  font-size: clamp(2.5rem, 7vw, 6rem);
  font-weight: 800;
  line-height: 1.05;
  margin-bottom: 1.5rem;
  opacity: 0;
  animation: fadeUp 0.8s 0.5s forwards;
}

.hero-title span {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-sub {
  font-size: 1rem;
  color: var(--muted);
  max-width: 520px;
  line-height: 1.7;
  margin-bottom: 3rem;
  opacity: 0;
  animation: fadeUp 0.8s 0.7s forwards;
}

.hero-stats {
  display: flex;
  gap: 3rem;
  margin-bottom: 3rem;
  opacity: 0;
  animation: fadeUp 0.8s 0.9s forwards;
}

.stat {
  text-align: center;
}

.stat-n {
  font-family: var(--font-mono);
  font-size: 2rem;
  font-weight: 700;
  color: var(--accent);
  display: block;
}

.stat-l {
  font-size: 0.7rem;
  color: var(--muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

.cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.9rem 2rem;
  background: var(--accent);
  color: #000;
  font-family: var(--font-mono);
  font-size: 0.8rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-decoration: none;
  border-radius: 4px;
  transition: all 0.2s;
  border: none;
  cursor: pointer;
  opacity: 0;
  animation: fadeUp 0.8s 1.1s forwards;
}

.cta-btn:hover {
  background: #fff;
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(0,255,136,0.3);
}

/* ‚îÄ‚îÄ PROGRESS PANEL ‚îÄ‚îÄ */
#progress-section {
  position: relative;
  z-index: 1;
  padding: 4rem 2rem;
  max-width: 1100px;
  margin: 0 auto;
}

.section-title {
  font-family: var(--font-display);
  font-size: 1.8rem;
  font-weight: 800;
  margin-bottom: 0.5rem;
}

.section-sub {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--muted);
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 2.5rem;
}

.overall-progress {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 2rem;
  margin-bottom: 2rem;
}

.progress-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.75rem;
  font-family: var(--font-mono);
  font-size: 0.75rem;
  color: var(--muted);
}

.progress-label span:last-child {
  color: var(--accent);
}

.progress-track {
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  border-radius: 3px;
  transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
}

/* ‚îÄ‚îÄ ROADMAP ‚îÄ‚îÄ */
#roadmap {
  position: relative;
  z-index: 1;
  padding: 2rem 2rem 6rem;
  max-width: 1100px;
  margin: 0 auto;
}

.blocks-container {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

/* ‚îÄ‚îÄ BLOCK ‚îÄ‚îÄ */
.block-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  transition: border-color 0.3s;
}

.block-card:hover {
  border-color: var(--accent2);
}

.block-header {
  padding: 1.5rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
  border-bottom: 1px solid var(--border);
}

.block-left {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.block-num {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--accent);
  background: rgba(0,255,136,0.1);
  padding: 0.3rem 0.6rem;
  border-radius: 4px;
  letter-spacing: 0.1em;
}

.block-title {
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 700;
}

.block-sub {
  font-size: 0.75rem;
  color: var(--muted);
  margin-top: 0.2rem;
}

.block-right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.block-progress-mini {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--muted);
}

.chevron {
  color: var(--muted);
  transition: transform 0.3s;
  font-size: 1rem;
}

.block-card.open .chevron {
  transform: rotate(180deg);
}

.block-body {
  display: none;
  padding: 1.5rem 2rem;
}

.block-card.open .block-body {
  display: block;
}

/* ‚îÄ‚îÄ CHAPTERS ‚îÄ‚îÄ */
.chapters-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.chapter-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1.25rem;
  transition: all 0.2s;
  cursor: pointer;
}

.chapter-card:hover {
  border-color: var(--accent2);
  transform: translateY(-2px);
}

.chapter-card.completed {
  border-color: var(--accent);
  background: rgba(0,255,136,0.05);
}

.ch-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.ch-num {
  font-family: var(--font-mono);
  font-size: 0.6rem;
  color: var(--muted);
}

.ch-check {
  width: 18px;
  height: 18px;
  border: 2px solid var(--border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6rem;
  transition: all 0.2s;
  flex-shrink: 0;
}

.chapter-card.completed .ch-check {
  background: var(--accent);
  border-color: var(--accent);
  color: #000;
}

.ch-title {
  font-family: var(--font-display);
  font-size: 0.95rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  line-height: 1.3;
}

.ch-topics {
  font-size: 0.72rem;
  color: var(--muted);
  line-height: 1.6;
}

.ch-topics li {
  list-style: none;
  padding-left: 1rem;
  position: relative;
}

.ch-topics li::before {
  content: '‚Ä∫';
  position: absolute;
  left: 0;
  color: var(--accent2);
}

.resources-list {
  margin-top: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.resource-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.6rem 0.75rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 0.75rem;
  text-decoration: none;
  color: var(--text);
  transition: all 0.2s;
}

.resource-item:hover {
  border-color: var(--accent2);
  color: var(--accent2);
}

.resource-type {
  font-family: var(--font-mono);
  font-size: 0.6rem;
  padding: 0.2rem 0.5rem;
  border-radius: 3px;
  flex-shrink: 0;
}

.rt-video { background: rgba(255,107,53,0.2); color: var(--accent3); }
.rt-book { background: rgba(0,180,255,0.2); color: var(--accent2); }
.rt-course { background: rgba(0,255,136,0.2); color: var(--accent); }
.rt-paper { background: rgba(255,215,0,0.2); color: var(--gold); }
.rt-doc { background: rgba(125,133,144,0.2); color: var(--muted); }
.rt-code { background: rgba(255,71,87,0.2); color: var(--danger); }

/* ‚îÄ‚îÄ EXAM CARD ‚îÄ‚îÄ */
.exam-card {
  border: 1px solid var(--accent3);
  background: rgba(255,107,53,0.05);
  border-radius: 8px;
  padding: 1.25rem 1.5rem;
  margin-top: 1.5rem;
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}

.exam-card.passed {
  border-color: var(--accent);
  background: rgba(0,255,136,0.05);
}

.exam-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.exam-title {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--accent3);
  letter-spacing: 0.1em;
  margin-bottom: 0.4rem;
}

.exam-card.passed .exam-title {
  color: var(--accent);
}

.exam-topics {
  font-size: 0.75rem;
  color: var(--muted);
  line-height: 1.6;
}

.exam-btn {
  margin-top: 0.75rem;
  padding: 0.5rem 1rem;
  background: transparent;
  border: 1px solid var(--accent3);
  color: var(--accent3);
  font-family: var(--font-mono);
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s;
}

.exam-btn:hover {
  background: var(--accent3);
  color: #000;
}

.exam-card.passed .exam-btn {
  border-color: var(--accent);
  color: var(--accent);
}

.exam-card.passed .exam-btn:hover {
  background: var(--accent);
  color: #000;
}

/* ‚îÄ‚îÄ ACHIEVEMENTS ‚îÄ‚îÄ */
#achievements {
  position: relative;
  z-index: 1;
  padding: 4rem 2rem;
  max-width: 1100px;
  margin: 0 auto;
}

.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
}

.achievement {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1.25rem;
  text-align: center;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.achievement.unlocked {
  border-color: var(--gold);
  background: rgba(255,215,0,0.05);
}

.achievement.unlocked::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at 50% 0%, rgba(255,215,0,0.1), transparent 70%);
}

.achievement-icon {
  font-size: 2rem;
  margin-bottom: 0.75rem;
  display: block;
  filter: grayscale(1) opacity(0.3);
  transition: filter 0.3s;
}

.achievement.unlocked .achievement-icon {
  filter: none;
}

.achievement-name {
  font-family: var(--font-display);
  font-size: 0.85rem;
  font-weight: 700;
  margin-bottom: 0.3rem;
}

.achievement-desc {
  font-size: 0.7rem;
  color: var(--muted);
  line-height: 1.5;
}

.achievement-badge {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--border);
}

.achievement.unlocked .achievement-badge {
  background: var(--gold);
  box-shadow: 0 0 8px var(--gold);
}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.toast {
  background: var(--surface2);
  border: 1px solid var(--accent);
  border-radius: 8px;
  padding: 1rem 1.25rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.8rem;
  animation: slideInRight 0.4s ease, fadeOut 0.4s 3.5s forwards;
  max-width: 320px;
  box-shadow: 0 8px 32px rgba(0,255,136,0.15);
}

.toast-icon { font-size: 1.2rem; }
.toast-text { line-height: 1.4; }
.toast-title { font-weight: 600; color: var(--accent); display: block; }
.toast-sub { color: var(--muted); font-size: 0.72rem; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(8px);
  z-index: 500;
  align-items: center;
  justify-content: center;
}

.modal-overlay.open {
  display: flex;
}

.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 2.5rem;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
}

.modal-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  color: var(--muted);
  cursor: pointer;
  font-size: 1.2rem;
  transition: color 0.2s;
}

.modal-close:hover { color: var(--text); }

.modal-title {
  font-family: var(--font-display);
  font-size: 1.4rem;
  font-weight: 800;
  margin-bottom: 0.5rem;
}

.modal-label {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--accent3);
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 1.5rem;
  display: block;
}

.modal-topics {
  font-size: 0.85rem;
  color: var(--muted);
  line-height: 1.8;
  margin-bottom: 1.5rem;
}

.modal-topics li {
  padding: 0.3rem 0;
  padding-left: 1.25rem;
  position: relative;
  list-style: none;
}

.modal-topics li::before {
  content: '‚ñ∏';
  position: absolute;
  left: 0;
  color: var(--accent);
}

.modal-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.btn-primary {
  padding: 0.7rem 1.5rem;
  background: var(--accent);
  color: #000;
  border: none;
  border-radius: 4px;
  font-family: var(--font-mono);
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary:hover {
  background: #fff;
  transform: translateY(-1px);
}

.btn-secondary {
  padding: 0.7rem 1.5rem;
  background: transparent;
  color: var(--muted);
  border: 1px solid var(--border);
  border-radius: 4px;
  font-family: var(--font-mono);
  font-size: 0.7rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-secondary:hover {
  color: var(--text);
  border-color: var(--muted);
}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer {
  position: relative;
  z-index: 1;
  padding: 3rem 2rem;
  text-align: center;
  border-top: 1px solid var(--border);
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--muted);
  letter-spacing: 0.1em;
}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(40px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; pointer-events: none; }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* ‚îÄ‚îÄ STATE MANAGER COMPONENT ‚îÄ‚îÄ */
.state-manager {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1.5rem 2rem;
  margin-top: 1.5rem;
  position: relative;
  overflow: hidden;
}

.state-manager::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--accent2), var(--accent), var(--accent3));
}

.sm-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.25rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.sm-title-wrap {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.sm-icon {
  width: 32px;
  height: 32px;
  background: rgba(0,180,255,0.1);
  border: 1px solid rgba(0,180,255,0.3);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  flex-shrink: 0;
}

.sm-title {
  font-family: var(--font-display);
  font-size: 0.95rem;
  font-weight: 700;
}

.sm-subtitle {
  font-family: var(--font-mono);
  font-size: 0.6rem;
  color: var(--muted);
  letter-spacing: 0.08em;
  margin-top: 0.1rem;
}

.sm-actions {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.sm-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.55rem 1rem;
  border-radius: 5px;
  font-family: var(--font-mono);
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
  white-space: nowrap;
}

.sm-btn-export {
  background: rgba(0,180,255,0.12);
  color: var(--accent2);
  border: 1px solid rgba(0,180,255,0.3);
}

.sm-btn-export:hover {
  background: var(--accent2);
  color: #000;
  box-shadow: 0 4px 16px rgba(0,180,255,0.3);
  transform: translateY(-1px);
}

.sm-btn-import {
  background: rgba(0,255,136,0.08);
  color: var(--accent);
  border: 1px solid rgba(0,255,136,0.25);
}

.sm-btn-import:hover {
  background: var(--accent);
  color: #000;
  box-shadow: 0 4px 16px rgba(0,255,136,0.25);
  transform: translateY(-1px);
}

.sm-btn-reset {
  background: rgba(255,71,87,0.08);
  color: var(--danger);
  border: 1px solid rgba(255,71,87,0.2);
}

.sm-btn-reset:hover {
  background: var(--danger);
  color: #fff;
  box-shadow: 0 4px 16px rgba(255,71,87,0.25);
  transform: translateY(-1px);
}

.sm-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 0.75rem;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}

.sm-stat {
  background: var(--surface2);
  border-radius: 6px;
  padding: 0.6rem 0.8rem;
  text-align: center;
}

.sm-stat-val {
  font-family: var(--font-mono);
  font-size: 1rem;
  font-weight: 700;
  color: var(--accent2);
  display: block;
}

.sm-stat-lbl {
  font-size: 0.6rem;
  color: var(--muted);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-top: 0.2rem;
}

.sm-drop-zone {
  display: none;
  margin-top: 1rem;
  border: 2px dashed rgba(0,255,136,0.3);
  border-radius: 8px;
  padding: 2rem;
  text-align: center;
  transition: all 0.2s;
  cursor: pointer;
}

.sm-drop-zone.visible { display: block; }

.sm-drop-zone.drag-over {
  border-color: var(--accent);
  background: rgba(0,255,136,0.05);
}

.sm-drop-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  display: block;
  animation: bounce 2s ease-in-out infinite;
}

.sm-drop-text {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--muted);
  line-height: 1.6;
}

.sm-drop-text span {
  color: var(--accent);
  cursor: pointer;
  text-decoration: underline;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

/* ‚îÄ‚îÄ CONFIRM DIALOG ‚îÄ‚îÄ */
.confirm-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(6px);
  z-index: 600;
  align-items: center;
  justify-content: center;
}

.confirm-overlay.open { display: flex; }

.confirm-box {
  background: var(--surface);
  border: 1px solid var(--danger);
  border-radius: 10px;
  padding: 2rem;
  max-width: 380px;
  width: 90%;
  text-align: center;
}

.confirm-icon { font-size: 2.5rem; margin-bottom: 1rem; display: block; }

.confirm-title {
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 800;
  margin-bottom: 0.5rem;
}

.confirm-desc {
  font-size: 0.8rem;
  color: var(--muted);
  line-height: 1.6;
  margin-bottom: 1.5rem;
}

.confirm-btns {
  display: flex;
  gap: 0.75rem;
  justify-content: center;
}

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--muted); }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 640px) {
  .hero-stats { gap: 1.5rem; }
  .chapters-grid { grid-template-columns: 1fr; }
  .achievements-grid { grid-template-columns: repeat(2, 1fr); }
  nav { padding: 1rem; }
}
</style>
</head>
<body>

<canvas id="bg-canvas"></canvas>

<!-- NAV -->
<nav>
  <span class="nav-logo">&gt; AI_DEVELOPER_PATH</span>
  <ul class="nav-links">
    <li><a href="#progress-section">Progreso</a></li>
    <li><a href="#roadmap">Temario</a></li>
    <li><a href="#achievements">Logros</a></li>
  </ul>
  <div class="nav-xp">
    <span id="nav-xp-text">0 XP</span>
    <div class="xp-bar-wrap">
      <div class="xp-bar-fill" id="nav-xp-bar" style="width:0%"></div>
    </div>
  </div>
</nav>

<!-- HERO -->
<section id="hero">
  <p class="hero-label">// Ruta de formaci√≥n profesional</p>
  <h1 class="hero-title">De Backend Dev<br>a <span>AI Developer</span></h1>
  <p class="hero-sub">Un programa estructurado para entender la IA desde los cimientos matem√°ticos hasta la construcci√≥n de modelos y sistemas en producci√≥n.</p>
  <div class="hero-stats">
    <div class="stat">
      <span class="stat-n">10</span>
      <span class="stat-l">Cap√≠tulos</span>
    </div>
    <div class="stat">
      <span class="stat-n">5</span>
      <span class="stat-l">Bloques</span>
    </div>
    <div class="stat">
      <span class="stat-n">12m</span>
      <span class="stat-l">Estimado</span>
    </div>
  </div>
  <a href="#roadmap" class="cta-btn">Comenzar ruta ‚Üì</a>
</section>

<!-- PROGRESS -->
<section id="progress-section">
  <p class="section-sub">// Tu avance</p>
  <h2 class="section-title">Panel de Progreso</h2>
  <div class="overall-progress">
    <div class="progress-label">
      <span>Progreso total del programa</span>
      <span id="pct-text">0%</span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="total-bar" style="width:0%"></div>
    </div>
  </div>

  <!-- STATE MANAGER COMPONENT -->
  <div class="state-manager" id="state-manager">
    <div class="sm-header">
      <div class="sm-title-wrap">
        <div class="sm-icon">üíæ</div>
        <div>
          <div class="sm-title">Gestor de Progreso</div>
          <div class="sm-subtitle">// EXPORTAR ¬∑ IMPORTAR ¬∑ SINCRONIZAR</div>
        </div>
      </div>
      <div class="sm-actions">
        <button class="sm-btn sm-btn-export" onclick="StateManager.export()">
          ‚Üì Exportar progreso
        </button>
        <button class="sm-btn sm-btn-import" onclick="StateManager.toggleImportZone()">
          ‚Üë Importar progreso
        </button>
        <button class="sm-btn sm-btn-reset" onclick="StateManager.confirmReset()">
          ‚äò Resetear
        </button>
      </div>
    </div>

    <!-- Drop Zone -->
    <div class="sm-drop-zone" id="sm-drop-zone"
      onclick="document.getElementById('sm-file-input').click()"
      ondragover="StateManager.onDragOver(event)"
      ondragleave="StateManager.onDragLeave(event)"
      ondrop="StateManager.onDrop(event)">
      <span class="sm-drop-icon">üìÇ</span>
      <div class="sm-drop-text">
        Arrastra aqu√≠ tu archivo <code style="color:var(--accent2)">.json</code> de progreso<br>
        o <span onclick="event.stopPropagation(); document.getElementById('sm-file-input').click()">haz click para seleccionar</span>
      </div>
      <input type="file" id="sm-file-input" accept=".json" style="display:none" onchange="StateManager.onFileSelect(event)">
    </div>

    <!-- Stats snapshot -->
    <div class="sm-info">
      <div class="sm-stat">
        <span class="sm-stat-val" id="sm-chapters">0/10</span>
        <div class="sm-stat-lbl">Cap√≠tulos</div>
      </div>
      <div class="sm-stat">
        <span class="sm-stat-val" id="sm-exams">0/5</span>
        <div class="sm-stat-lbl">Ex√°menes</div>
      </div>
      <div class="sm-stat">
        <span class="sm-stat-val" id="sm-achievements">0/12</span>
        <div class="sm-stat-lbl">Logros</div>
      </div>
      <div class="sm-stat">
        <span class="sm-stat-val" id="sm-xp">0</span>
        <div class="sm-stat-lbl">XP Total</div>
      </div>
      <div class="sm-stat">
        <span class="sm-stat-val" id="sm-saved-at">‚Äî</span>
        <div class="sm-stat-lbl">√öltimo guardado</div>
      </div>
    </div>
  </div>
</section>

<!-- CONFIRM DIALOG -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <span class="confirm-icon">‚ö†Ô∏è</span>
    <div class="confirm-title">¬øResetear todo?</div>
    <div class="confirm-desc">Se borrar√° todo tu progreso: cap√≠tulos completados, ex√°menes aprobados, logros y XP. Esta acci√≥n no se puede deshacer.</div>
    <div class="confirm-btns">
      <button class="sm-btn sm-btn-reset" onclick="StateManager.executeReset()">S√≠, resetear</button>
      <button class="sm-btn sm-btn-export" onclick="document.getElementById('confirm-overlay').classList.remove('open')">Cancelar</button>
    </div>
  </div>
</div>

<!-- ROADMAP -->
<section id="roadmap">
  <p class="section-sub">// Temario completo</p>
  <h2 class="section-title">Mapa de Aprendizaje</h2>
  <div class="blocks-container" id="blocks-container">
    <!-- generado por JS -->
  </div>
</section>

<!-- ACHIEVEMENTS -->
<section id="achievements">
  <p class="section-sub">// Hitos desbloqueados</p>
  <h2 class="section-title">Logros</h2>
  <div class="achievements-grid" id="achievements-grid">
    <!-- generado por JS -->
  </div>
</section>

<footer>
  &copy; 2025 AI Developer Path ¬∑ Hecho con ‚ô• y Three.js ¬∑ Tu progreso se guarda localmente
</footer>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div id="modal-content"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toast-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const COURSE = [
  {
    id: 'b1',
    num: 'BLOQUE I',
    title: 'Fundamentos Matem√°ticos y Program√°ticos',
    sub: '"El suelo sobre el que se construye todo"',
    accentColor: '#00ff88',
    chapters: [
      {
        id: 'c1',
        num: 'CAP 1',
        title: 'Matem√°ticas para Machine Learning',
        topics: [
          '√Ålgebra lineal: vectores, matrices, valores propios',
          'C√°lculo: derivadas, regla de la cadena, gradientes',
          'Probabilidad: distribuciones, Bayes, esperanza, varianza'
        ],
        resources: [
          { label: '3B1B ‚Äî Essence of Linear Algebra', type: 'video', url: 'https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab' },
          { label: '3B1B ‚Äî Essence of Calculus', type: 'video', url: 'https://www.youtube.com/playlist?list=PLZHQObOWTQDMsr9K-rj53DwVRMYO3t5Yr' },
          { label: 'StatQuest ‚Äî Statistics Fundamentals', type: 'video', url: 'https://www.youtube.com/playlist?list=PLblh5JKOoLUK0FLuzwntyYI10UQFUhsY9' },
          { label: 'Mathematics for Machine Learning (PDF libre)', type: 'book', url: 'https://mml-book.github.io/' },
          { label: 'ML-Foundations ‚Äî Jon Krohn (GitHub)', type: 'code', url: 'https://github.com/jonkrohn/ML-foundations' }
        ]
      },
      {
        id: 'c2',
        num: 'CAP 2',
        title: 'Python Cient√≠fico para IA',
        topics: [
          'Python avanzado: clases, iteradores, decoradores',
          'NumPy: broadcasting, indexing, operaciones tensoriales',
          'Pandas, Matplotlib, Jupyter/Colab'
        ],
        resources: [
          { label: 'Advanced Python Mastery ‚Äî Beazley (GitHub)', type: 'code', url: 'https://github.com/dabeaz-course/python-mastery' },
          { label: 'NumPy Quickstart (oficial)', type: 'doc', url: 'https://numpy.org/doc/stable/user/quickstart.html' },
          { label: 'Fluent Python ‚Äî Ramalho', type: 'book', url: 'https://www.oreilly.com/library/view/fluent-python-2nd/9781492056348/' },
          { label: 'Tensor Puzzles ‚Äî srush (GitHub)', type: 'code', url: 'https://github.com/srush/Tensor-Puzzles' },
          { label: 'Google Colab (entorno GPU gratuito)', type: 'doc', url: 'https://colab.research.google.com/' }
        ]
      }
    ],
    exam: {
      id: 'e1',
      title: 'EXAMEN 1',
      topics: [
        'Operaciones matriciales y su significado geom√©trico',
        'C√°lculo de gradientes manualmente (regla de la cadena)',
        'Estad√≠stica descriptiva e inferencial b√°sica',
        'Manipulaci√≥n de arrays con NumPy sin loops expl√≠citos',
        'Broadcasting y reshaping de tensores'
      ]
    }
  },
  {
    id: 'b2',
    num: 'BLOQUE II',
    title: 'Machine Learning Cl√°sico',
    sub: '"Los algoritmos que preceden a las redes neuronales"',
    accentColor: '#00b4ff',
    chapters: [
      {
        id: 'c3',
        num: 'CAP 3',
        title: 'Fundamentos de Machine Learning',
        topics: [
          'Aprendizaje supervisado vs no supervisado vs RL',
          'Regresi√≥n lineal y log√≠stica desde cero',
          'Gradient Descent, SGD, optimizaci√≥n',
          'Overfitting, underfitting, regularizaci√≥n L1/L2',
          'Validaci√≥n cruzada, √°rboles, Random Forests, SVM'
        ],
        resources: [
          { label: 'Stanford CS229 ‚Äî Andrew Ng (YouTube)', type: 'video', url: 'https://www.youtube.com/playlist?list=PLoROMvodv4rMiGQp3WXShtMGgzqpfKKDY' },
          { label: 'CS229 Lecture Notes (PDF oficial)', type: 'doc', url: 'https://cs229.stanford.edu/main_notes.pdf' },
          { label: 'The Hundred-Page ML Book ‚Äî Burkov', type: 'book', url: 'http://themlbook.com/' },
          { label: 'ML From Scratch ‚Äî eriklindernoren', type: 'code', url: 'https://github.com/eriklindernoren/ML-From-Scratch' },
          { label: 'Google ML Crash Course', type: 'course', url: 'https://developers.google.com/machine-learning/crash-course' }
        ]
      },
      {
        id: 'c4',
        num: 'CAP 4',
        title: 'PyTorch: El Framework',
        topics: [
          'Tensores en PyTorch vs NumPy',
          'Autograd: diferenciaci√≥n autom√°tica',
          'nn.Module, bucle de entrenamiento',
          'GPU acceleration (CUDA)',
          'Guardar y cargar modelos'
        ],
        resources: [
          { label: 'PyTorch Tutorials oficiales', type: 'doc', url: 'https://pytorch.org/tutorials/' },
          { label: 'Aladdin Persson ‚Äî PyTorch Tutorials (YouTube)', type: 'video', url: 'https://www.youtube.com/playlist?list=PLhhyoLH6IjfxeoooqP9rhU3HJIAVAJ3Vz' },
          { label: 'MiniTorch ‚Äî DIY ML Engineering', type: 'course', url: 'https://minitorch.github.io/' }
        ]
      }
    ],
    exam: {
      id: 'e2',
      title: 'EXAMEN 2',
      topics: [
        'Implementaci√≥n desde cero de regresi√≥n lineal con gradient descent',
        'Diferencias entre paradigmas de aprendizaje',
        'Diagn√≥stico de underfitting/overfitting y soluciones',
        'Funcionamiento interno del autograd de PyTorch',
        'Construcci√≥n y entrenamiento de modelo simple con nn.Module'
      ]
    }
  },
  {
    id: 'b3',
    num: 'BLOQUE III',
    title: 'Deep Learning',
    sub: '"De perceptr√≥n a arquitecturas modernas"',
    accentColor: '#ff6b35',
    chapters: [
      {
        id: 'c5',
        num: 'CAP 5',
        title: 'Redes Neuronales desde Cero',
        topics: [
          'Perceptr√≥n y MLP',
          'Funciones de activaci√≥n: ReLU, sigmoid, softmax',
          'Backpropagation: derivaci√≥n manual y computacional',
          'Batch Normalization, Dropout, inicializaci√≥n de pesos',
          'Gradiente desvaneciente/explosivo'
        ],
        resources: [
          { label: 'Neural Networks: Zero to Hero ‚Äî Karpathy', type: 'video', url: 'https://karpathy.ai/zero-to-hero.html' },
          { label: 'nn-zero-to-hero GitHub (notebooks)', type: 'code', url: 'https://github.com/karpathy/nn-zero-to-hero' },
          { label: 'Dive into Deep Learning d2l.ai (Cap 1‚Äì6)', type: 'book', url: 'https://d2l.ai/' }
        ]
      },
      {
        id: 'c6',
        num: 'CAP 6',
        title: 'Arquitecturas Especializadas',
        topics: [
          'CNNs: convoluci√≥n, pooling, LeNet, ResNet',
          'RNNs: vanishing gradients, LSTM, GRU',
          'Sequence-to-sequence models',
          'Embeddings: Word2Vec, representaciones densas'
        ],
        resources: [
          { label: 'Deep Learning Specialization ‚Äî Andrew Ng (Coursera)', type: 'course', url: 'https://www.coursera.org/specializations/deep-learning' },
          { label: 'Practical Deep Learning for Coders ‚Äî fast.ai', type: 'course', url: 'https://course.fast.ai/' },
          { label: 'Dive into Deep Learning ‚Äî Cap 7‚Äì10 (CNNs, RNNs)', type: 'book', url: 'https://d2l.ai/chapter_convolutional-neural-networks/index.html' }
        ]
      }
    ],
    exam: {
      id: 'e3',
      title: 'EXAMEN 3',
      topics: [
        'Backpropagation manual en red de 2 capas',
        'Construcci√≥n de un autograd engine simple tipo micrograd',
        'Diferencias entre CNN, RNN, LSTM y cu√°ndo usar cada uno',
        'Diagn√≥stico de problemas de entrenamiento',
        'Clasificador de im√°genes con CNN en PyTorch'
      ]
    }
  },
  {
    id: 'b4',
    num: 'BLOQUE IV',
    title: 'Transformers y LLMs',
    sub: '"La arquitectura que lo cambi√≥ todo"',
    accentColor: '#a855f7',
    chapters: [
      {
        id: 'c7',
        num: 'CAP 7',
        title: 'La Arquitectura Transformer',
        topics: [
          'Attention mechanism: scaled dot-product',
          'Multi-head attention',
          'Positional encoding',
          'Encoder vs Decoder vs Encoder-Decoder',
          'Tokenizaci√≥n y Byte Pair Encoding (BPE)'
        ],
        resources: [
          { label: 'Attention Is All You Need (arXiv paper)', type: 'paper', url: 'https://arxiv.org/abs/1706.03762' },
          { label: 'The Illustrated Transformer ‚Äî Jay Alammar', type: 'doc', url: 'https://jalammar.github.io/illustrated-transformer/' },
          { label: "Let's build GPT from scratch ‚Äî Karpathy", type: 'video', url: 'https://www.youtube.com/watch?v=kCc8FmEb1nY' },
          { label: 'Dive into Deep Learning ‚Äî Cap 11 (Attention)', type: 'book', url: 'https://d2l.ai/chapter_attention-mechanisms-and-transformers/index.html' }
        ]
      },
      {
        id: 'c8',
        num: 'CAP 8',
        title: 'LLMs: Pre-entrenamiento, Fine-tuning y RLHF',
        topics: [
          'Pre-entrenamiento: next token prediction, masked LM',
          'Transfer Learning y Fine-Tuning',
          'LoRA, QLoRA, adapters (PEFT)',
          'RLHF: Reinforcement Learning from Human Feedback',
          'Cuantizaci√≥n: int4/int8, modelos locales (Ollama)'
        ],
        resources: [
          { label: 'Hugging Face LLM Course (gratuito)', type: 'course', url: 'https://huggingface.co/learn/llm-course' },
          { label: 'Build a LLM from Scratch ‚Äî Sebastian Raschka', type: 'book', url: 'https://www.manning.com/books/build-a-large-language-model-from-scratch' },
          { label: 'Understanding LLMs ‚Äî Raschka (art√≠culo)', type: 'doc', url: 'https://magazine.sebastianraschka.com/p/understanding-large-language-models' },
          { label: 'Fine-tuning LLMs ‚Äî HuggingFace Chapter 11', type: 'course', url: 'https://huggingface.co/learn/llm-course/en/chapter11/1' }
        ]
      }
    ],
    exam: {
      id: 'e4',
      title: 'EXAMEN 4',
      topics: [
        'Funcionamiento interno del mecanismo de atenci√≥n (con f√≥rmulas)',
        'Diferencias entre modelos encoder-only, decoder-only, encoder-decoder',
        'Proceso de tokenizaci√≥n BPE',
        'Full fine-tuning vs LoRA: cu√°ndo usar cada uno',
        'Implementaci√≥n de Transformer b√°sico en PyTorch desde cero'
      ]
    }
  },
  {
    id: 'b5',
    num: 'BLOQUE V',
    title: 'Aplicaci√≥n Pr√°ctica y Producci√≥n',
    sub: '"Del modelo al sistema"',
    accentColor: '#ffd700',
    chapters: [
      {
        id: 'c9',
        num: 'CAP 9',
        title: 'Modelos en Producci√≥n y MLOps',
        topics: [
          'Servicio de modelos (FastAPI + PyTorch, ONNX)',
          'Evaluaci√≥n y benchmarking',
          'Monitoreo: data drift, model drift',
          'Versionado de experimentos (MLflow, W&B)',
          'C√≥mputo y costo (GPU cloud, quantization)'
        ],
        resources: [
          { label: 'Designing Machine Learning Systems ‚Äî Chip Huyen', type: 'book', url: 'https://www.oreilly.com/library/view/designing-machine-learning/9781098107956/' },
          { label: 'Weights & Biases Docs', type: 'doc', url: 'https://docs.wandb.ai/' },
          { label: 'MLflow Documentaci√≥n', type: 'doc', url: 'https://mlflow.org/docs/latest/index.html' },
          { label: 'Full Stack Deep Learning ‚Äî LLMOps (Berkeley)', type: 'course', url: 'https://fullstackdeeplearning.com/llm-bootcamp/' }
        ]
      },
      {
        id: 'c10',
        num: 'CAP 10',
        title: 'Agentes de IA y Sistemas Multi-Agente',
        topics: [
          'Arquitectura de agente: percepci√≥n, razonamiento, acci√≥n',
          'Tool use / Function calling',
          'RAG (Retrieval Augmented Generation)',
          'Orquestaci√≥n: LangGraph, AutoGen',
          'Sistemas multi-agente: coordinaci√≥n y memoria'
        ],
        resources: [
          { label: 'Hugging Face ‚Äî Agents Course (gratuito)', type: 'course', url: 'https://huggingface.co/learn/agents-course' },
          { label: 'LangGraph Documentaci√≥n oficial', type: 'doc', url: 'https://langchain-ai.github.io/langgraph/' },
          { label: 'RAG from scratch ‚Äî LangChain YouTube', type: 'video', url: 'https://www.youtube.com/playlist?list=PLfaIDFEXuae2LXbO1_PKyVJiQ23ZztA0x' }
        ]
      }
    ],
    exam: {
      id: 'ef',
      title: 'EXAMEN FINAL',
      topics: [
        'Dise√±o completo de pipeline ML/IA: datos hasta producci√≥n',
        'Evaluaci√≥n y selecci√≥n de arquitecturas para distintos problemas',
        'Implementaci√≥n de agente con tool use y memoria',
        'Fine-tuning de LLM open-source con LoRA',
        'Trade-offs de costo/rendimiento en sistemas de IA reales'
      ]
    }
  }
];

const ACHIEVEMENTS = [
  { id: 'ach_first', icon: 'üöÄ', name: 'Primer Paso', desc: 'Completaste tu primer cap√≠tulo', trigger: (s) => s.completedChapters >= 1 },
  { id: 'ach_math', icon: '‚àë', name: 'Matem√°tico', desc: 'Completaste los fundamentos matem√°ticos', trigger: (s) => s.completedChapters >= 2 },
  { id: 'ach_ml', icon: 'üìê', name: 'ML Cl√°sico', desc: 'Completaste el bloque de ML cl√°sico', trigger: (s) => s.completedChapters >= 4 },
  { id: 'ach_exam1', icon: 'üìã', name: 'Primera prueba', desc: 'Aprobaste el primer examen', trigger: (s) => s.passedExams.includes('e1') },
  { id: 'ach_halfway', icon: '‚ö°', name: 'A mitad de camino', desc: '5 cap√≠tulos completados', trigger: (s) => s.completedChapters >= 5 },
  { id: 'ach_dl', icon: 'üß†', name: 'Deep Learner', desc: 'Completaste el bloque de Deep Learning', trigger: (s) => s.completedChapters >= 6 },
  { id: 'ach_transformer', icon: 'ü§ñ', name: 'Transformer Master', desc: 'Dominaste la arquitectura Transformer', trigger: (s) => isChapterDone('c7') && isChapterDone('c8') },
  { id: 'ach_exam3', icon: 'üèÜ', name: 'Tri-Examinado', desc: 'Aprobaste 3 ex√°menes', trigger: (s) => s.passedExams.length >= 3 },
  { id: 'ach_allchapters', icon: 'üìö', name: 'Completista', desc: 'Todos los cap√≠tulos completados', trigger: (s) => s.completedChapters >= 10 },
  { id: 'ach_graduate', icon: 'üéì', name: 'AI Developer', desc: 'Completaste el programa entero', trigger: (s) => s.passedExams.length >= 5 && s.completedChapters >= 10 },
  { id: 'ach_speed', icon: 'üí®', name: 'Fast Learner', desc: 'Completaste 3 cap√≠tulos seguidos', trigger: (s) => s.streak >= 3 },
  { id: 'ach_xp500', icon: '‚ú®', name: '500 XP', desc: 'Acumulaste 500 puntos de experiencia', trigger: (s) => s.xp >= 500 }
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadState() {
  try {
    const saved = localStorage.getItem('ai_course_state');
    if (saved) return JSON.parse(saved);
  } catch(e) {}
  return {
    completedChapters: 0,
    completedChapterIds: [],
    passedExams: [],
    unlockedAchievements: [],
    xp: 0,
    streak: 0
  };
}

function saveState() {
  localStorage.setItem('ai_course_state', JSON.stringify(state));
}

let state = loadState();

function isChapterDone(id) {
  return state.completedChapterIds.includes(id);
}

function isExamPassed(id) {
  return state.passedExams.includes(id);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// THREE.JS BACKGROUND
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function initThree() {
  const canvas = document.getElementById('bg-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setSize(window.innerWidth, window.innerHeight);

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.z = 5;

  // Particle field ‚Äî neural network aesthetic
  const particleCount = 500;
  const positions = new Float32Array(particleCount * 3);
  const colors = new Float32Array(particleCount * 3);

  for (let i = 0; i < particleCount; i++) {
    positions[i * 3]     = (Math.random() - 0.5) * 20;
    positions[i * 3 + 1] = (Math.random() - 0.5) * 20;
    positions[i * 3 + 2] = (Math.random() - 0.5) * 10;

    const t = Math.random();
    if (t < 0.5) {
      colors[i * 3] = 0; colors[i * 3 + 1] = 1; colors[i * 3 + 2] = 0.53; // green
    } else if (t < 0.8) {
      colors[i * 3] = 0; colors[i * 3 + 1] = 0.7; colors[i * 3 + 2] = 1;  // blue
    } else {
      colors[i * 3] = 1; colors[i * 3 + 1] = 0.42; colors[i * 3 + 2] = 0.2; // orange
    }
  }

  const pGeo = new THREE.BufferGeometry();
  pGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  pGeo.setAttribute('color', new THREE.BufferAttribute(colors, 3));

  const pMat = new THREE.PointsMaterial({
    size: 0.04,
    vertexColors: true,
    transparent: true,
    opacity: 0.6
  });

  const particles = new THREE.Points(pGeo, pMat);
  scene.add(particles);

  // Connection lines (sparse)
  const lineGeo = new THREE.BufferGeometry();
  const linePositions = [];
  const lineColors = [];
  const sampleCount = 80;
  for (let i = 0; i < sampleCount; i++) {
    const a = Math.floor(Math.random() * particleCount);
    const b = Math.floor(Math.random() * particleCount);
    linePositions.push(
      positions[a*3], positions[a*3+1], positions[a*3+2],
      positions[b*3], positions[b*3+1], positions[b*3+2]
    );
    lineColors.push(0, 1, 0.53, 0, 0.7, 1);
  }
  lineGeo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(linePositions), 3));
  lineGeo.setAttribute('color', new THREE.BufferAttribute(new Float32Array(lineColors), 3));
  const lineMat = new THREE.LineBasicMaterial({ vertexColors: true, transparent: true, opacity: 0.06 });
  const lines = new THREE.LineSegments(lineGeo, lineMat);
  scene.add(lines);

  let mouseX = 0, mouseY = 0;
  document.addEventListener('mousemove', (e) => {
    mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
    mouseY = -(e.clientY / window.innerHeight - 0.5) * 2;
  });

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  function animate(t) {
    requestAnimationFrame(animate);
    const time = t * 0.001;
    particles.rotation.y = time * 0.03 + mouseX * 0.1;
    particles.rotation.x = time * 0.01 + mouseY * 0.05;
    lines.rotation.y = particles.rotation.y;
    lines.rotation.x = particles.rotation.x;
    renderer.render(scene, camera);
  }
  animate(0);
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function rtClass(type) {
  return `rt-${type}`;
}

function rtLabel(type) {
  const map = { video: '‚ñ∂ VIDEO', book: 'üìñ LIBRO', course: 'üéì CURSO', paper: 'üìÑ PAPER', doc: 'üìã DOC', code: 'üíª C√ìDIGO' };
  return map[type] || type.toUpperCase();
}

function renderBlocks() {
  const container = document.getElementById('blocks-container');
  container.innerHTML = '';

  COURSE.forEach((block) => {
    const doneInBlock = block.chapters.filter(ch => isChapterDone(ch.id)).length;
    const totalInBlock = block.chapters.length;
    const examDone = isExamPassed(block.exam.id);

    const card = document.createElement('div');
    card.className = 'block-card';
    card.id = `block-${block.id}`;

    const chHTML = block.chapters.map(ch => {
      const done = isChapterDone(ch.id);
      return `
        <div class="chapter-card ${done ? 'completed' : ''}" onclick="openChapterModal('${ch.id}')">
          <div class="ch-header">
            <span class="ch-num">${ch.num}</span>
            <div class="ch-check">${done ? '‚úì' : ''}</div>
          </div>
          <div class="ch-title">${ch.title}</div>
          <ul class="ch-topics">
            ${ch.topics.slice(0,3).map(t => `<li>${t}</li>`).join('')}
          </ul>
          <div class="resources-list" style="margin-top:0.75rem">
            ${ch.resources.map(r => `
              <a class="resource-item" href="${r.url}" target="_blank" rel="noopener">
                <span class="resource-type ${rtClass(r.type)}">${rtLabel(r.type)}</span>
                <span>${r.label}</span>
              </a>
            `).join('')}
          </div>
        </div>
      `;
    }).join('');

    const examTopics = block.exam.topics.map(t => `<li>${t}</li>`).join('');

    card.innerHTML = `
      <div class="block-header" onclick="toggleBlock('${block.id}')">
        <div class="block-left">
          <span class="block-num" style="color:${block.accentColor};background:${block.accentColor}20">${block.num}</span>
          <div>
            <div class="block-title">${block.title}</div>
            <div class="block-sub">${block.sub}</div>
          </div>
        </div>
        <div class="block-right">
          <span class="block-progress-mini">${doneInBlock}/${totalInBlock} caps</span>
          <span class="chevron">‚ñº</span>
        </div>
      </div>
      <div class="block-body">
        <div class="chapters-grid">${chHTML}</div>
        <div class="exam-card ${examDone ? 'passed' : ''}">
          <div class="exam-icon">${examDone ? '‚úÖ' : 'üìã'}</div>
          <div>
            <div class="exam-title">${block.exam.title} ${examDone ? '‚Äî APROBADO' : ''}</div>
            <div class="exam-topics">Temas evaluados:<br><ul style="margin-top:0.4rem">${examTopics}</ul></div>
            <button class="exam-btn" onclick="toggleExam('${block.exam.id}')">
              ${examDone ? 'Marcar como pendiente' : 'Marcar como aprobado'}
            </button>
          </div>
        </div>
      </div>
    `;

    container.appendChild(card);
  });
}

function toggleBlock(id) {
  const card = document.getElementById(`block-${id}`);
  card.classList.toggle('open');
}

function toggleExam(examId) {
  if (isExamPassed(examId)) {
    state.passedExams = state.passedExams.filter(e => e !== examId);
    state.xp = Math.max(0, state.xp - 100);
  } else {
    state.passedExams.push(examId);
    state.xp += 100;
    showToast('üèÜ', '¬°Examen aprobado!', '+100 XP', '#ffd700');
  }
  saveState();
  renderBlocks();
  updateProgress();
  checkAchievements();
}

function openChapterModal(chId) {
  // chapters are flat lookup
  let ch = null;
  COURSE.forEach(b => b.chapters.forEach(c => { if (c.id === chId) ch = c; }));
  if (!ch) return;

  const done = isChapterDone(chId);

  document.getElementById('modal-content').innerHTML = `
    <span class="modal-label">${ch.num}</span>
    <div class="modal-title">${ch.title}</div>
    <div style="font-family:var(--font-mono);font-size:0.65rem;color:var(--muted);margin-bottom:1.5rem;letter-spacing:0.05em">
      ${done ? '‚úÖ COMPLETADO' : '‚è≥ PENDIENTE'}
    </div>
    <div style="margin-bottom:1rem;font-family:var(--font-mono);font-size:0.7rem;color:var(--accent);letter-spacing:0.1em">TEMAS</div>
    <ul class="modal-topics">
      ${ch.topics.map(t => `<li>${t}</li>`).join('')}
    </ul>
    <div style="margin-top:1.25rem;margin-bottom:0.75rem;font-family:var(--font-mono);font-size:0.7rem;color:var(--accent2);letter-spacing:0.1em">RECURSOS</div>
    <div class="resources-list">
      ${ch.resources.map(r => `
        <a class="resource-item" href="${r.url}" target="_blank" rel="noopener">
          <span class="resource-type ${rtClass(r.type)}">${rtLabel(r.type)}</span>
          <span>${r.label}</span>
        </a>
      `).join('')}
    </div>
    <div class="modal-actions">
      <button class="btn-primary" onclick="toggleChapter('${chId}')">
        ${done ? 'Marcar como pendiente' : '‚úì Marcar como completado'}
      </button>
      <button class="btn-secondary" onclick="closeModal()">Cerrar</button>
    </div>
  `;
  document.getElementById('modal-overlay').classList.add('open');
}

function toggleChapter(chId) {
  if (isChapterDone(chId)) {
    state.completedChapterIds = state.completedChapterIds.filter(c => c !== chId);
    state.completedChapters = state.completedChapterIds.length;
    state.xp = Math.max(0, state.xp - 50);
  } else {
    state.completedChapterIds.push(chId);
    state.completedChapters = state.completedChapterIds.length;
    state.streak++;
    state.xp += 50;
    showToast('üìö', '¬°Cap√≠tulo completado!', '+50 XP', '#00ff88');
  }
  saveState();
  closeModal();
  renderBlocks();
  updateProgress();
  checkAchievements();
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}

document.getElementById('modal-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateProgress() {
  const totalChapters = 10;
  const pct = Math.round((state.completedChapters / totalChapters) * 100);
  document.getElementById('total-bar').style.width = pct + '%';
  document.getElementById('pct-text').textContent = pct + '%';

  const maxXP = 800;
  const xpPct = Math.min(100, Math.round((state.xp / maxXP) * 100));
  document.getElementById('nav-xp-text').textContent = state.xp + ' XP';
  document.getElementById('nav-xp-bar').style.width = xpPct + '%';

  // Sync manager stats if component is ready
  if (typeof StateManager !== 'undefined') StateManager.updateStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACHIEVEMENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAchievements() {
  const grid = document.getElementById('achievements-grid');
  grid.innerHTML = '';
  ACHIEVEMENTS.forEach(ach => {
    const unlocked = state.unlockedAchievements.includes(ach.id);
    const el = document.createElement('div');
    el.className = `achievement ${unlocked ? 'unlocked' : ''}`;
    el.innerHTML = `
      <div class="achievement-badge"></div>
      <span class="achievement-icon">${ach.icon}</span>
      <div class="achievement-name">${ach.name}</div>
      <div class="achievement-desc">${ach.desc}</div>
    `;
    grid.appendChild(el);
  });
}

function checkAchievements() {
  let newlyUnlocked = false;
  ACHIEVEMENTS.forEach(ach => {
    if (!state.unlockedAchievements.includes(ach.id)) {
      try {
        if (ach.trigger(state)) {
          state.unlockedAchievements.push(ach.id);
          newlyUnlocked = true;
          setTimeout(() => {
            showToast(ach.icon, '¬°Logro desbloqueado!', ach.name, '#ffd700');
          }, 500);
        }
      } catch(e) {}
    }
  });
  if (newlyUnlocked) {
    saveState();
    renderAchievements();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(icon, title, sub, color = '#00ff88') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.style.borderColor = color;
  toast.innerHTML = `
    <span class="toast-icon">${icon}</span>
    <div class="toast-text">
      <span class="toast-title" style="color:${color}">${title}</span>
      <span class="toast-sub">${sub}</span>
    </div>
  `;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE MANAGER COMPONENT
// Encargado de: leer JSON externo, validarlo,
// aplicarlo al estado global y redibujar la UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const StateManager = (() => {

  // ‚îÄ‚îÄ Schema de validaci√≥n ‚îÄ‚îÄ
  const VALID_CHAPTER_IDS = ['c1','c2','c3','c4','c5','c6','c7','c8','c9','c10'];
  const VALID_EXAM_IDS    = ['e1','e2','e3','e4','ef'];
  const VALID_ACH_IDS     = ACHIEVEMENTS.map(a => a.id);

  function validate(raw) {
    if (typeof raw !== 'object' || raw === null) throw new Error('El archivo no contiene un objeto JSON v√°lido.');

    const errors = [];

    if (!Array.isArray(raw.completedChapterIds))
      errors.push('completedChapterIds debe ser un array.');
    else {
      const invalid = raw.completedChapterIds.filter(id => !VALID_CHAPTER_IDS.includes(id));
      if (invalid.length) errors.push(`IDs de cap√≠tulo desconocidos: ${invalid.join(', ')}`);
    }

    if (!Array.isArray(raw.passedExams))
      errors.push('passedExams debe ser un array.');
    else {
      const invalid = raw.passedExams.filter(id => !VALID_EXAM_IDS.includes(id));
      if (invalid.length) errors.push(`IDs de examen desconocidos: ${invalid.join(', ')}`);
    }

    if (!Array.isArray(raw.unlockedAchievements))
      errors.push('unlockedAchievements debe ser un array.');

    if (typeof raw.xp !== 'number' || raw.xp < 0)
      errors.push('xp debe ser un n√∫mero positivo.');

    if (errors.length) throw new Error(errors.join('\n'));

    return true;
  }

  // ‚îÄ‚îÄ Aplicar estado importado a la app ‚îÄ‚îÄ
  function applyState(imported) {
    // Merge: respetamos s√≥lo campos conocidos, descartamos basura
    state.completedChapterIds  = imported.completedChapterIds.filter(id => VALID_CHAPTER_IDS.includes(id));
    state.completedChapters    = state.completedChapterIds.length;
    state.passedExams          = imported.passedExams.filter(id => VALID_EXAM_IDS.includes(id));
    state.unlockedAchievements = (imported.unlockedAchievements || []).filter(id => VALID_ACH_IDS.includes(id));
    state.xp                   = typeof imported.xp === 'number' ? imported.xp : 0;
    state.streak               = typeof imported.streak === 'number' ? imported.streak : 0;

    saveState();

    // Redibujar toda la UI
    renderBlocks();
    updateProgress();
    renderAchievements();
    updateManagerStats();

    showToast('‚úÖ', '¬°Progreso importado!', `${state.completedChapters} caps ¬∑ ${state.passedExams.length} ex√°menes ¬∑ ${state.xp} XP`, '#00ff88');
  }

  // ‚îÄ‚îÄ Parsear y procesar un string JSON ‚îÄ‚îÄ
  function processJSON(text) {
    let raw;
    try {
      raw = JSON.parse(text);
    } catch(e) {
      showToast('‚ùå', 'JSON inv√°lido', 'El archivo no se pudo parsear.', '#ff4757');
      return;
    }

    try {
      validate(raw);
      applyState(raw);
      toggleImportZone(false);
    } catch(e) {
      showToast('‚ùå', 'Datos inv√°lidos', e.message.split('\n')[0], '#ff4757');
    }
  }

  // ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ
  function exportState() {
    const payload = {
      ...state,
      _version: 1,
      _exportedAt: new Date().toISOString(),
      _app: 'ai-developer-path'
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href     = url;
    const date = new Date().toISOString().slice(0,10);
    a.download = `ai-course-progress-${date}.json`;
    a.click();
    URL.revokeObjectURL(url);
    showToast('üíæ', '¬°Progreso exportado!', a.download, '#00b4ff');
  }

  // ‚îÄ‚îÄ IMPORT zone toggle ‚îÄ‚îÄ
  function toggleImportZone(force) {
    const zone = document.getElementById('sm-drop-zone');
    const isVisible = zone.classList.contains('visible');
    const show = force !== undefined ? force : !isVisible;
    zone.classList.toggle('visible', show);
  }

  // ‚îÄ‚îÄ Drag & Drop handlers ‚îÄ‚îÄ
  function onDragOver(e) {
    e.preventDefault();
    document.getElementById('sm-drop-zone').classList.add('drag-over');
  }

  function onDragLeave(e) {
    document.getElementById('sm-drop-zone').classList.remove('drag-over');
  }

  function onDrop(e) {
    e.preventDefault();
    document.getElementById('sm-drop-zone').classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (!file) return;
    if (!file.name.endsWith('.json')) {
      showToast('‚ùå', 'Archivo inv√°lido', 'Solo se aceptan archivos .json', '#ff4757');
      return;
    }
    readFile(file);
  }

  // ‚îÄ‚îÄ File input handler ‚îÄ‚îÄ
  function onFileSelect(e) {
    const file = e.target.files[0];
    if (!file) return;
    readFile(file);
    e.target.value = '';
  }

  function readFile(file) {
    const reader = new FileReader();
    reader.onload = (e) => processJSON(e.target.result);
    reader.onerror = () => showToast('‚ùå', 'Error de lectura', 'No se pudo leer el archivo.', '#ff4757');
    reader.readAsText(file);
  }

  // ‚îÄ‚îÄ Reset ‚îÄ‚îÄ
  function confirmReset() {
    document.getElementById('confirm-overlay').classList.add('open');
  }

  function executeReset() {
    document.getElementById('confirm-overlay').classList.remove('open');

    // Reset al estado inicial
    state.completedChapters    = 0;
    state.completedChapterIds  = [];
    state.passedExams          = [];
    state.unlockedAchievements = [];
    state.xp                   = 0;
    state.streak               = 0;

    saveState();
    renderBlocks();
    updateProgress();
    renderAchievements();
    updateManagerStats();
    showToast('üîÑ', 'Progreso reseteado', 'Empezando desde cero.', '#ff4757');
  }

  // ‚îÄ‚îÄ Actualizar stats del componente ‚îÄ‚îÄ
  function updateStats() {
    const el = (id) => document.getElementById(id);

    el('sm-chapters').textContent    = `${state.completedChapters}/10`;
    el('sm-exams').textContent       = `${state.passedExams.length}/5`;
    el('sm-achievements').textContent = `${state.unlockedAchievements.length}/12`;
    el('sm-xp').textContent          = state.xp;

    try {
      const raw = localStorage.getItem('ai_course_state');
      if (raw) {
        const parsed = JSON.parse(raw);
        if (parsed._savedAt) {
          const d = new Date(parsed._savedAt);
          el('sm-saved-at').textContent = d.toLocaleDateString('es', { day:'2-digit', month:'short' });
        } else {
          el('sm-saved-at').textContent = 'Hoy';
        }
      }
    } catch(e) {
      el('sm-saved-at').textContent = '‚Äî';
    }
  }

  // API p√∫blica
  return {
    export: exportState,
    toggleImportZone: (f) => toggleImportZone(f),
    onDragOver,
    onDragLeave,
    onDrop,
    onFileSelect,
    confirmReset,
    executeReset,
    updateStats
  };
})();

// Alias para llamar desde HTML
function updateManagerStats() { StateManager.updateStats(); }

// Patch saveState para guardar timestamp
const _originalSave = saveState;
function saveState() {
  state._savedAt = new Date().toISOString();
  localStorage.setItem('ai_course_state', JSON.stringify(state));
}

// Cerrar confirm al click fuera
document.getElementById('confirm-overlay').addEventListener('click', function(e) {
  if (e.target === this) this.classList.remove('open');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
renderBlocks();
updateProgress();
renderAchievements();
checkAchievements();
StateManager.updateStats();

// Auto-open first block
setTimeout(() => {
  const first = document.getElementById('block-b1');
  if (first) first.classList.add('open');
}, 300);
</script>
</body>
</html>
